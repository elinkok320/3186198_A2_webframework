---
import Layout from "../layouts/Layout.astro"; 
---

<Layout title="Sign up">

  <div id="signup-page">

      <form id="form">
        <label class="user-info">
          <h4>First Name</h4>
          <input name="first-name" type="text">
        </label>

        <label class="user-info">
          <h4>Last Name</h4>
          <input name="last-name" type="text">
        </label>

        <label class="user-info">
          <h4>Birth Date</h4>
          <input name="birthday" type="date">
        </label>

        <label class="user-info">
          <h4>Email</h4>
          <input name="email" type="email">
        </label>

        <label class="user-info">
          <h4>Password</h4>
          <input name="password" type="password" minlength="6">
        </label>
        
        <button type="submit">Create account</button>
      </form>

      <p style="font-size: 16px;">
        Already have an account? <a href="/login" style="color:#375c66;">Login</a>
      </p>
  </div>

  <style>
    #signup-page{
      color: #fef9c8;
      background-color: #ed401c;
      padding: 1rem 4rem;
      display: flex;
      flex-flow: column wrap;
      justify-content: center;
      align-items: center;
    }
    #form{
      display: flex;
      flex-flow: column wrap;
      justify-content: center;
      align-items: flex-start;
      gap: 1rem;
      
    }
    .user-info h4{
      font-size: 20px;
      margin: 10px;
    }
    .user-info input{
      margin: 0;
      background-color: #fef9c8;
      border: solid 2px #fef9c8;
      border-radius: 5px;
      padding: 10px 20px;
      width:15rem ;
      box-shadow: -2px -2px 2px rgba(0,0,0,0.4);
    }
    .user-info input:hover{
      box-shadow: 2px 2px 2px rgba(0,0,0,0.4);
      transition: 0.5s;
    }
    button{
      font-family:"KatalesBroken";
      color: #ed401c;
      font-size: 20px;
      margin: 20px;
      padding: 10px 20px;
      background-color: #fef9c8;
      border: solid 2px #fef9c8;
      border-radius: 5px;
      margin-bottom: 10px;
      box-shadow: -2px -2px 2px rgba(0,0,0,0.4);
    }
    button:hover{
      transition: 0.2s;
      transform: rotate(5deg) scale(1.5);
      box-shadow: 2px 2px 4px rgba(0,0,0,0.4);
      border: solid 2px #375c66;
    }
    a:hover{
      text-decoration: none;
      transition: 0.5s;
    }
    input{
      font-family: "KatalesBroken";
      font-size: 20px;
    }
  </style>


</Layout>

<script type="module">
  import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';
  
  const supabase = createClient(
    'https://xarsycpiqgviqkxyodbv.supabase.co',  
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhhcnN5Y3BpcWd2aXFreHlvZGJ2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc0NDk5NDksImV4cCI6MjA4MzAyNTk0OX0.Oppyl8Oz3RrPAHdjjZkGV8SX-m1GdGOgga9KqPRNySI' 
  );

  const form = document.querySelector("#form");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const fd = new FormData(form);
    const firstName = fd.get("first-name")?.toString().trim();
    const lastName  = fd.get("last-name")?.toString().trim();
    const birthday  = fd.get("birthday")?.toString();  
    const email     = fd.get("email")?.toString().trim();
    const password  = fd.get("password")?.toString();

    const { data, error } = await supabase.auth.signUp({
      email,
      password,
      options: {
      data: {
          first_name: firstName,
          last_name: lastName,
          birthday: birthday
        }
      }
    });

    if (error) {
      alert(error.message);
      return;
    }

    alert("You're now a Chilli Padi");
    window.location.href = "/login";
  });
</script>
